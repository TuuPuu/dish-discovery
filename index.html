<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üçî DishDiscovery üçî</title>

    <!-- FONT AWESOME -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- TEMP CSS STYLE SHEET -->
    <link rel="stylesheet" href="./src/style.css" />
    <style>
      /* WE'LL ADD BOOTSTRAP LAST*/
    </style>
  </head>

  <body>
    <div class="container">
      <h2>üçî DishDiscovery üçî</h2>
      <div>
        <!-- SEARCH BAR FORM -->
        <form>
          <input
            class="search-bar"
            type="text"
            placeholder="Search Bar (What are you looking for?)"
            required
          />
          <button class="search-button" type="submit">üîç</button>
        </form>

        <!-- FAVOURITE BUTTON -->
        <i class="fa-solid fa-star" id="addToFavorites">
          <span class="fav-text">Add to Favourites</span></i
        >
      </div>

      <div class="recipeContainer">
        <div>
          <!-- RECIPE DETAIL -->
          <h3>Here are your results:</h3>
          <div class="cardContainer">
            <div class="recipe-detail">
              <h2>Recipe</h2>
            </div>

            <!-- YOUTUBE COOKING TUTORIAL -->
            <div class="youtube-vid">
              <h2>Tutorial</h2>
              Lorem ipsum dolor sit, amet consectetur adipisicing elit. Aliquam
              exercitationem, illum ut corporis earum itaque minus nesciunt unde
              corrupti esse veritatis, cumque quam ex suscipit, explicabo autem
              voluptas! Magnam, ad.
            </div>

            <!-- FAVOURITES INFO made changes here -->
            <div class="fav-info" id="favoritesContainer">
              <h2>Favorites</h2>
              <ul id="favoritesList"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JAVASCIPT FILE BELOW made changes here -->
    <!-- jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script>
      // made changes here
      function getRecipe(searchQuery) {
        fetch(
          `https://www.themealdb.com/api/json/v1/1/search.php?s=${searchQuery}`
        )
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            if (data.meals) {
              displayRecipe(data.meals[0]);
            } else {
              console.log("Meal not found");
            }
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
          });
      }

      // ADDED SEARCH BUTTON PRESS - made changes here
      $("form").submit(function (e) {
        e.preventDefault(); // Prevents the default form submission behavior
        const searchQuery = $(".search-bar").val();
        getRecipe(searchQuery); // Passes the searchQuery to getRecipe
      });

      // ADDED ENTER KEY PRESS - made changes here
      $(".search-bar").on("keydown", function (e) {
        if (e.key === "Enter") {
          // 'Enter' key pressed
          e.preventDefault(); // Prevents the default form submission behaviour
          const searchQuery = $(".search-bar").val();
          getRecipe(searchQuery); // Passes the searchQuery to getRecipe
        }
      });

      // Display recipe - made changes here
      function displayRecipe(data) {
        const recipeSection = $(".recipe-detail");
        recipeSection.empty(); // this is here to clear previous content

        const recipeName = data.strMeal;
        const MealThumb = data.strMealThumb;
        const ingredients = getIngredientsArray(data);
        const instructions = data.strInstructions;

        const content = `
              <div class="p-4">
                  <img src="${MealThumb}" alt="${recipeName}" class="img-fluid" style="max-width: 100%; height: auto;">
                  <h2>${recipeName}</h2>
                  <h4>Ingredients:</h4>
                  <ul style="padding-left: 20px">${ingredients}</ul>
                  <h4>Instructions:</h4>
                  <p>${instructions}</p>
              </div>
              <br>
          `;

        recipeSection.append(content);
      }

      // GET INGREDIENTS ARRAY - made some changes
      function getIngredientsArray(data) {
        const ingredientsArray = [];
        for (let i = 1; i <= 20; i++) {
          const ingredient = data[`strIngredient${i}`];
          if (ingredient) {
            const measure = data[`strMeasure${i}`];
            ingredientsArray.push(`<li>${measure} ${ingredient}</li>`);
          } else {
            break; // Stops loop if there are no more ingredients
          }
        }
        return ingredientsArray.join("");
      }

      // YOUTUBE API
      /*const dataItems = [
        {
          kind: "youtube#searchResult",
          etag: "euKZ7mdj1jDP5G5bE4PTzgMY43o",
          id: {
            kind: "youtube#video",
            videoId: "yeGPkgglBJk",
          },
          snippet: {
            publishedAt: "2023-12-21T15:15:08Z",
            channelId: "UCPvMxy7CQQ3XUcF0sAXUJlg",
            title:
              "The BEST Cheesy Lasagna Recipes üçùüßÄ | Aesthetic Baking TikTok Compilations",
            description:
              "The BEST Cheesy Lasagna Recipes | Aesthetic Baking TikTok Compilations My Baking Blog: anisacakesandbakes.com My ...",
            thumbnails: {
              default: {
                url: "https://i.ytimg.com/vi/yeGPkgglBJk/default.jpg",
                width: 120,
                height: 90,
              },
              medium: {
                url: "https://i.ytimg.com/vi/yeGPkgglBJk/mqdefault.jpg",
                width: 320,
                height: 180,
              },
              high: {
                url: "https://i.ytimg.com/vi/yeGPkgglBJk/hqdefault.jpg",
                width: 480,
                height: 360,
              },
            },
            channelTitle: "baking compilations ü§ç ",
            liveBroadcastContent: "none",
            publishTime: "2023-12-21T15:15:08Z",
          },
        },
        {
          kind: "youtube#searchResult",
          etag: "9-bNFuOUn16MaoDJDjz5ctci6_A",
          id: {
            kind: "youtube#video",
            videoId: "g3ogYrKABE0",
          },
          snippet: {
            publishedAt: "2023-05-25T09:05:15Z",
            channelId: "UCzrYomXGyR1nxvzAAI6qQbA",
            title:
              "Lasagne on a budget ‚ù§Ô∏è#foodhacks #hacks #diy #foodie #lasagna",
            description: "",
            thumbnails: {
              default: {
                url: "https://i.ytimg.com/vi/g3ogYrKABE0/default.jpg",
                width: 120,
                height: 90,
              },
              medium: {
                url: "https://i.ytimg.com/vi/g3ogYrKABE0/mqdefault.jpg",
                width: 320,
                height: 180,
              },
              high: {
                url: "https://i.ytimg.com/vi/g3ogYrKABE0/hqdefault.jpg",
                width: 480,
                height: 360,
              },
            },
            channelTitle: "Robyn Douman",
            liveBroadcastContent: "none",
            publishTime: "2023-05-25T09:05:15Z",
          },
        },
        {
          kind: "youtube#searchResult",
          etag: "xN6CcYOHNvBfuR55Mv0ygfnirW8",
          id: {
            kind: "youtube#video",
            videoId: "fAu4GbaoyEg",
          },
          snippet: {
            publishedAt: "2022-01-14T12:48:19Z",
            channelId: "UCjz3tesrOA7mg652QYNbTcQ",
            title: "#Vegan Lentil &amp; Mushroom Lasagne",
            description:
              "A delicious veg-packed lasagne. Full recipe here: https://budgetfriendlyvegan.com/easy-vegan-lasagne-recipe/",
            thumbnails: {
              default: {
                url: "https://i.ytimg.com/vi/fAu4GbaoyEg/default.jpg",
                width: 120,
                height: 90,
              },
              medium: {
                url: "https://i.ytimg.com/vi/fAu4GbaoyEg/mqdefault.jpg",
                width: 320,
                height: 180,
              },
              high: {
                url: "https://i.ytimg.com/vi/fAu4GbaoyEg/hqdefault.jpg",
                width: 480,
                height: 360,
              },
            },
            channelTitle: "Budget Friendly Vegan",
            liveBroadcastContent: "none",
            publishTime: "2022-01-14T12:48:19Z",
          },
        },
        {
          kind: "youtube#searchResult",
          etag: "X6eR0Hsm7PtBX3n41evrbXQXhgE",
          id: {
            kind: "youtube#video",
            videoId: "9vxznjbdfv0",
          },
          snippet: {
            publishedAt: "2023-12-20T16:18:41Z",
            channelId: "UCvlC5Ctzp2z8aCTBPRVDx7g",
            title: "Lasagne vegane FACILI e DELIZIOSE üå±",
            description:
              "Le lasagne vegane rappresentano una deliziosa e nutriente alternativa sostenibile alle classiche lasagne alla bolognese.",
            thumbnails: {
              default: {
                url: "https://i.ytimg.com/vi/9vxznjbdfv0/default.jpg",
                width: 120,
                height: 90,
              },
              medium: {
                url: "https://i.ytimg.com/vi/9vxznjbdfv0/mqdefault.jpg",
                width: 320,
                height: 180,
              },
              high: {
                url: "https://i.ytimg.com/vi/9vxznjbdfv0/hqdefault.jpg",
                width: 480,
                height: 360,
              },
            },
            channelTitle: "Ilaria Food and Home",
            liveBroadcastContent: "none",
            publishTime: "2023-12-20T16:18:41Z",
          },
        },
        {
          kind: "youtube#searchResult",
          etag: "-ZoWQ-UFA85MQYEVpHw29tQRglI",
          id: {
            kind: "youtube#video",
            videoId: "7NiwVIPrVRU",
          },
          snippet: {
            publishedAt: "2023-03-20T17:47:05Z",
            channelId: "UCBy23fBwiAs7kPwu-WTgWlw",
            title: "my first time making lasagne",
            description: "",
            thumbnails: {
              default: {
                url: "https://i.ytimg.com/vi/7NiwVIPrVRU/default.jpg",
                width: 120,
                height: 90,
              },
              medium: {
                url: "https://i.ytimg.com/vi/7NiwVIPrVRU/mqdefault.jpg",
                width: 320,
                height: 180,
              },
              high: {
                url: "https://i.ytimg.com/vi/7NiwVIPrVRU/hqdefault.jpg",
                width: 480,
                height: 360,
              },
            },
            channelTitle: "ChrisThe Fish03",
            liveBroadcastContent: "none",
            publishTime: "2023-03-20T17:47:05Z",
          },
        },
      ];*/
      // let data= JSON.parse(dataItems)
      // console.log(dataItems);
      // console.log(dataItems[0].snippet);

      // var search = $("search").val();
      // fetch(
      //   "https://youtube.googleapis.com/youtube/v3/search?part=snippet&&order=rating&q=" +
      //     search +
      //     "&type=video&key=AIzaSyAk79jO8CvLdZ_YqsuS1D-8KE9hRawHOfY"
      // );

      // .then((res)=>{
      //     return res.json()
      // })
      // .then((data)=>{
      //     console.log(data)
      //     var thumbnailUrl= data.items[0].snippet.thumbnails.default.url;

      //    console.log(data.items[0].id.videoId)
      //    var videoID= data.items[0].id.videoId
      //    var youtubeUrl= "https://www.youtube.com/watch?v=g3ogYrKABE0"
      //    var url = youtubeUrl+videoID
      //    console.log
      //    "https://www.youtube.com/watch?v=Z9yaG27quz0"

      // console.log(dataItems[0].id.videoId);
      // console.log(dataItems[0].snippet.title);
      // var title = dataItems[0].snippet.title;
      // var videoId = dataItems[0].id.videoId;
      // var youtubeUrl = "https://www.youtube.com/watch?v=";
      // var fullUrl = youtubeUrl + videoId;
      // var thumbnail = dataItems[0].snippet.thumbnails.default.url;

      // var divEl = $("#player-container");
      // var title = $("<h1>").text(title);
      // var image = $("<img>");
      // var anchorTag = $("<a>");
      // anchorTag.attr("href", fullUrl).text("hello");
      // anchorTag.attr("target", "_blank");
      // image.attr("src", thumbnail);
      // divEl.append(title, image, anchorTag);

      // SAVE TO FAVOURITES
      // local Storage variables
      const favoritesList = $("#favoritesList");
      const addToFavorites = $("#addToFavorites");

      addToFavorites.click(function () {
        const searchQuery = $(".search-bar").val();
        const savedSearches =
          JSON.parse(localStorage.getItem("savedSearches")) || [];

        // checks if searchQuery already exists in savedSearches
        if (!savedSearches.includes(searchQuery)) {
          savedSearches.push(searchQuery);
          localStorage.setItem("savedSearches", JSON.stringify(savedSearches));
          displaySavedSearches();
        }
      });

      function displaySavedSearches() {
        favoritesList.empty();

        // retrieve saved searches from local storage or create an empty array if it doesn't exist
        const savedSearches =
          JSON.parse(localStorage.getItem("savedSearches")) || [];

        // iterate over the indices of the saved searches array
        for (let i = 0; i < savedSearches.length; i++) {
          // Capitalize the first letter of each search query
          const capitalisedQuery = capitaliseFirstLetter(savedSearches[i]);

          // create a div to enclose the list item and buttons
          const listItemContainer = $("<div>").addClass("list-item-container");

          // create list item and buttons
          const listItem = $("<li>").text(capitalisedQuery);
          const removeButton = $("<button>")
            .text("Remove")
            .addClass("remove-button");
          const viewButton = $("<button>").text("View").addClass("view-button");

          // add click event listeners to buttons
          removeButton.click(function () {
            removeSearch(savedSearches[i]);
          });

          viewButton.click(function () {
            getRecipe(savedSearches[i]); // passes the searchQuery to getRecipe
          });

          // append buttons to list item container
          listItemContainer.append(listItem, viewButton, removeButton);

          // append the list item container to the favoritesList
          favoritesList.append(listItemContainer);
        }
      }

      // function to capitalize the first letter of a string
      function capitaliseFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
      }

      // REMOVE FROM FAVOURITE
      function removeSearch(searchQuery) {
        const savedSearches =
          JSON.parse(localStorage.getItem("savedSearches")) || [];

        const updatedSearches = [];

        for (let i = 0; i < savedSearches.length; i++) {
          if (savedSearches[i] !== searchQuery) {
            updatedSearches.push(savedSearches[i]);
          }
        }

        localStorage.setItem("savedSearches", JSON.stringify(updatedSearches));

        displaySavedSearches();
      }

      displaySavedSearches();
    </script>
    <!-- <script src="script.js"></script> -->
  </body>
</html>
